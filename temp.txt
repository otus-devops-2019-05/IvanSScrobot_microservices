1. build docker image inside gitlab runner

previous IP: 35.239.202.107

register a runner properly:

sudo  docker exec -it gitlab-runner gitlab-runner register -n \
  --url http://104.198.248.218/ \
  --registration-token e8pyXzxMY8XTDxYZ5eDz\
  --executor docker \
  --description "Runner" \
  --docker-image "alpine:latest" \
  --docker-volumes /var/run/docker.sock:/var/run/docker.sock  \
  --run-untagged \
  --locked=false

docker exec -it gitlab-runner gitlab-runner register --run-untagged --locked=false --docker-volumes /var/run/docker.sock:/var/run/docker.sock

check variables:

$ echo 'CI_SERVER_HOST- '$CI_SERVER_HOST
CI_SERVER_HOST- 104.198.248.218
$ echo 'CI_COMMIT_REF_NAME- '$CI_COMMIT_REF_NAME
CI_COMMIT_REF_NAME- gitlab-ci-1
$ echo 'CI_PIPELINE_IID - '$CI_PIPELINE_IID
CI_PIPELINE_IID - 20

docs: https://docs.gitlab.com/ee/ci/docker/using_docker_build.html



================
2. autoscaling

1) install docker-machine

https://docs.docker.com/machine/install-machine/

https://docs.docker.com/machine/install-machine/https://docs.docker.com/machine/install-machine/
base=https://github.com/docker/machine/releases/download/v0.16.0 &&
  curl -L $base/docker-machine-$(uname -s)-$(uname -m) >/tmp/docker-machine &&
  sudo mv /tmp/docker-machine /usr/local/bin/docker-machine

2)install GCE
gcloud auth login

Optional - https://docs.gitlab.com/runner/executors/docker_machine.html#preparing-the-environment

3)register gitlab-runner for autoscaling 
 sudo  docker exec -it gitlab-runner gitlab-runner register -n \
  --url http://104.198.248.218/ \
  --registration-token e8pyXzxMY8XTDxYZ5eDz\
  --executor docker+machine \
  --description "autoscale-runner" \
  --docker-image "alpine:latest" \
  --run-untagged \
  --locked=false \

  4)Configure the runner
  /srv/gitlab-runner/config.toml
  